name: JMeter Master

on:
  workflow_dispatch:
    inputs:
      slave_ip:
        description: 'IP address of the JMeter slave'
        required: true
        type: string

jobs:
  jmeter-master:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up JMeter
      run: |
        sudo apt-get update
        sudo apt-get install -y openjdk-11-jdk
        wget https://archive.apache.org/dist/jmeter/binaries/apache-jmeter-5.4.1.tgz
        tar -xvzf apache-jmeter-5.4.1.tgz
        export JMETER_HOME=$PWD/apache-jmeter-5.4.1
        export PATH=$JMETER_HOME/bin:$PATH

    - name: Configure and run JMeter test
      run: |
        sudo chmod -R 777 $JMETER_HOME/bin
        echo "${{ github.event.inputs.slave_ip }}" | su -c 'tee $JMETER_HOME/bin/slaves.txt'
        jmeter -n -t your_test_plan.jmx -R${{ github.event.inputs.slave_ip }}

    - name: Post-test cleanup
      run: |
        echo "Test completed. Cleaning up..."
